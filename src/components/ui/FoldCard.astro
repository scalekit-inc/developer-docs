---
import '../../styles/folds.css'
import { getIconComponent } from '@/utils/icon-map'

export interface Props {
  title: string
  href?: string
  iconKey?: string
  logoUrl?: string
  cta?: string
  variant?: 'primary' | 'secondary' | 'minimal'
  showCta?: boolean
  target?: string
  rel?: string
  illustrationSvg?: string
  illustrationUrl?: string
  illustrationMaxWidth?: string
}

import { LinkButton } from 'starlight-theme-nova/components'
const {
  title,
  href,
  iconKey,
  logoUrl,
  cta = 'Know more â†’',
  variant = 'secondary',
  showCta = true,
  target,
  rel,
  illustrationSvg,
  illustrationUrl,
  illustrationMaxWidth = '300px',
} = Astro.props
const Icon = getIconComponent(iconKey)
---

<article
  class:list={['fold-card', 'sl-card', { 'has-illustration': illustrationSvg || illustrationUrl }]}
>
  <div class="card-main">
    <div class="card-header">
      {
        logoUrl ? (
          <img src={logoUrl} alt={`${title} logo`} class="card-icon img" aria-hidden="true" />
        ) : (
          Icon && <Icon class="card-icon" aria-hidden="true" />
        )
      }
      <h3 class="card-title">{title}</h3>
    </div>
    <div class="card-content">
      <slot />
      {
        href && showCta && (
          <LinkButton
            href={href}
            class={`card-cta sk-${variant}`}
            variant={variant}
            {...(target && { target })}
            {...(rel && { rel })}
          >
            {cta}
          </LinkButton>
        )
      }
    </div>
  </div>
  {
    illustrationSvg && (
      <div
        class="card-illustration"
        style={`max-width: ${illustrationMaxWidth}`}
        set:html={illustrationSvg}
      />
    )
  }
  {
    illustrationUrl && (
      <div class="card-illustration" style={`max-width: ${illustrationMaxWidth}`}>
        <img src={illustrationUrl} alt={`${title} illustration`} />
      </div>
    )
  }
</article>

<style>
  .fold-card {
    background: var(--sl-color-bg-card);
    border: 1px solid var(--sl-color-gray-6);
    border-radius: 0.5rem;
    padding: 1.5rem;
    transition: all 0.2s ease;
  }

  :root[data-theme='light'] .fold-card {
    background: #fff;
  }

  :root[data-theme='dark'] .fold-card {
    background: var(--sl-color-bg-card);
  }

  /* Two-column layout when illustration is present */
  .fold-card.has-illustration {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 2rem;
    align-items: center;
  }

  /* Stack on mobile */
  @media (max-width: 768px) {
    .fold-card.has-illustration {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .card-illustration {
      order: -1;
      max-width: 100%;
    }
  }

  .card-main {
    min-width: 0; /* Prevent grid overflow */
  }

  .card-header {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  :global(.card-icon) {
    font-size: 1.5rem;
    color: var(--sl-color-accent);
    flex-shrink: 0;
  }

  :global(.card-icon.img) {
    width: 2rem;
    height: 2rem;
    object-fit: contain;
  }

  .card-title {
    margin: 0;
    font-size: var(--sl-text-lg);
    font-weight: 600;
    color: var(--sl-color-text-heading);
  }

  .card-content {
    color: var(--sl-color-text-muted);
    line-height: 1.6;
  }

  .card-content :global(p:last-child) {
    margin-bottom: 0;
  }

  .card-cta {
    display: inline-block;
    margin-top: 1rem !important;

    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
    border-radius: 0.375rem;
  }

  .card-cta:hover {
    color: var(--sl-color-text);
  }

  .card-illustration {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .card-illustration :global(svg),
  .card-illustration img {
    max-width: 100%;
    height: auto;
    display: block;
  }
</style>
