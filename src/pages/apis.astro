---
// Import the `<StarlightPage>` component first to set up cascade layers
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro'
import { ScalarComponent } from '@scalar/astro'
import ApiSearchIndex from '@/components/ApiSearchIndex.astro'

// Page metadata
const frontmatter = {
  title: 'Scalekit API Reference',
  description: 'Complete reference for all Scalekit API endpoints',
  template: 'splash',
  editUrl: false,
  head: [
    {
      tag: 'style',
      content: `
        footer {
          display: none !important;
        }
        .content-panel:first-of-type:has(.sl-container:empty),
        .content-panel:first-of-type:not(:has(.api-reference-wrapper)) {
          display: none !important;
        }
        .content-panel:first-of-type:empty {
          display: none !important;
        }
        .scalar-api-reference {
          position: sticky;
          top: var(--sl-nav-height);
          height: calc(100vh - var(--sl-nav-height));
          overflow: auto;
        }
      `,
    },
  ],
}
---

<div class="scalar-api-reference">
  <ScalarComponent
    configuration={{
      url: '/api/scalekit.swagger.json',
      theme: 'default',
      layout: 'modern',
      pageTitle: 'Scalekit API',
      hideTestRequestButton: false,
      withDefaultFonts: false,
      hideModels: true,
      searchHotKey: 'p',
      hideDarkModeToggle: true,
      darkMode: false,
      proxyUrl: 'https://proxy.scalar.com',
      defaultOpenAllTags: false,
      servers: [
        {
          url: 'https://{environment}',
          description: 'Scalekit Environment',
          variables: {
            environment: {
              default: 'your-env.scalekit.com',
              description:
                'Your full Scalekit environment URL (e.g., my-env.scalekit.com or my-env.scalekit.dev)',
            },
          },
        },
      ],
      authentication: {
        preferredSecurityScheme: 'oauth2',
        securitySchemes: {
          oauth2: {
            flows: {
              clientCredentials: {
                tokenUrl: 'https://{environment}/oauth/token',
                'x-scalar-credentials-location': 'body',
                'x-scalar-security-body': {
                  grant_type: 'client_credentials',
                },
              },
            },
          },
        },
      },
      hiddenClients: {
        c: ['libcurl'],
        csharp: ['httpclient', 'restsharp'],
        clojure: ['clj_http'],
        dart: ['http'],
        go: ['native'],
        http: ['http1.1', 'http1', 'http2'],
        java: ['asynchttp', 'okhttp', 'unirest', 'nethttp'],
        js: ['xhr', 'fetch', 'axios', 'jquery', 'ofetch', 'request'],
        kotlin: ['okhttp'],
        node: ['undici', 'axios', 'fetch', 'ofetch'],
        objc: ['nsurlsession'],
        ocaml: ['cohttp'],
        // Some Scalar builds expose F# separately; hide its HttpClient if present
        fsharp: ['httpclient'],
        php: ['curl', 'guzzle'],
        powershell: ['restmethod', 'webrequest'],
        python: ['python3', 'requests', 'httpx_sync', 'httpx_async'],
        r: ['httr'],
        ruby: ['native'],
        rust: ['reqwest'],
        shell: ['httpie', 'wget'],
        swift: ['nsurlsession'],
      },
      favicon:
        'https://cdn.prod.website-files.com/65b87d98fa638289e10b8f61/67ab35acf2f180e0fe0a94a8_S%20Icon%20-%20Black%20-%2032x32.png',
      hideClientButton: true,
      baseServerURL: 'https://scalekit.com',
      documentDownloadType: 'json',
      defaultHttpClient: {
        targetKey: 'shell',
        clientKey: 'curl',
      },
      customCss: `#scalar-client-0 { margin-top: 8rem; }`,
    }}
  />
</div>

<StarlightPage frontmatter={frontmatter}>
  <!-- Hidden search index for Pagefind -->
  <div style="display: none;">
    <ApiSearchIndex />
  </div>
</StarlightPage>
