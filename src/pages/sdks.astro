---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro'
import { getCollection } from 'astro:content'
import FoldCard from '@components/ui/FoldCard.astro'
import { Code } from '@astrojs/starlight/components'
import { LinkButton } from 'starlight-theme-nova/components'
import { getSDKConfigs, formatTimeAgo } from '@/utils/release-helpers'
import '@/styles/pages/sdks.css'

// Load GitHub releases and get latest release data for each SDK
const releases = await getCollection('github-releases')

// Get SDK configurations with latest releases
const sdkConfig = getSDKConfigs(releases)

const frontmatter = {
  title: 'Scalekit SDKs and APIs',
  template: 'splash' as const,
  description: 'Secure your  MCP servers, APIs, users - in one scalable stack',
  tableOfContents: false,
  hero: {
    tagline:
      'Add MCP auth, Agent Auth, or SSO as modular components - or adopt the full-stack platform for your B2B, AI application',
  },
  prev: false,
  next: false,
}
---

<StarlightPage frontmatter={frontmatter} hasSidebar={false}>
  <div class="fold-section fold-full-width">
    <div class="fold-container">
      <div class="sdk-section-layout">
        <div class="sdk-header-section">
          <h1
            class="section-title"
            style="margin-top: 1.8rem !important; font-size: 1.9rem !important;"
          >
            SDKs
          </h1>
          <div class="section-subtitle"></div>
        </div>
        <div class="sdk-cards-grid">
          {
            Object.values(sdkConfig).map((sdk) => (
              <div class="sdk-card-wrapper">
                <FoldCard
                  title={sdk.title}
                  iconKey={sdk.icon}
                  href={sdk.href}
                  badge={sdk.release ? { text: sdk.release.tagName } : undefined}
                  showCta={false}
                  showTitle={false}
                  clickable={false}
                  ctaSmall={true}
                >
                  <div class="sdk-card-subtitle">{sdk.description}</div>

                  <div class="sdk-card-features">
                    {sdk.features.map((feature) => (
                      <div class="sdk-feature">{feature}</div>
                    ))}
                  </div>

                  <div class="sdk-bottom-row">
                    <div class="sdk-meta-row">
                      {sdk.release && (
                        <>
                          <div class="meta-item" title="Actively Maintained">
                            <span class="status-dot" />
                            Updated {formatTimeAgo(sdk.release.publishedAt)}
                          </div>

                          {/* Pulling stars directly from loader data */}
                          {sdk.release.repoStargazerCount > 50 && (
                            <div class="meta-item" title="GitHub Stars">
                              ‚≠ê {sdk.release.repoStargazerCount}
                            </div>
                          )}
                        </>
                      )}
                    </div>

                    <div class="sdk-actions">
                      <LinkButton
                        href={sdk.href}
                        variant="secondary"
                        icon="right-arrow"
                        iconPlacement="end"
                        class="sk-secondary"
                      >
                        Get Started
                      </LinkButton>
                    </div>
                  </div>
                </FoldCard>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>

  <div class="fold-section fold--background-muted fold-full-width">
    <div class="fold-container">
      <div class="api-section-layout">
        <div class="api-header-section">
          <h1
            class="section-title"
            style="margin-top: 1.8rem !important; font-size: 1.9rem !important;"
          >
            APIs
          </h1>
          <div class="section-description"></div>
        </div>
        <div class="api-cards-grid">
          <FoldCard
            title="REST APIs"
            iconKey="api"
            href="/apis/"
            showCta={false}
            showTitle={true}
            clickable={false}
            ctaSmall={true}
          >
            <div class="sdk-card-subtitle">
              Programmatic control to manage users, orgs, sessions, and more
            </div>

            <div class="sdk-bottom-row">
              <div class="sdk-meta-row">
                <!-- Empty for now -->
              </div>

              <div class="sdk-actions">
                <LinkButton
                  href="/apis/#description/quickstart"
                  variant="secondary"
                  icon="right-arrow"
                  iconPlacement="end"
                  class="sk-secondary"
                >
                  Get Started
                </LinkButton>
              </div>
            </div>
          </FoldCard>

          <FoldCard
            title="Webhooks"
            iconKey="webhooks"
            href="/apis/#webhook/organizationcreated"
            showCta={false}
            showTitle={true}
            clickable={false}
            ctaSmall={true}
          >
            <div class="sdk-card-subtitle">
              Receive real-time events for authentication, user lifecycle, and organizations
            </div>

            <div class="sdk-bottom-row">
              <div class="sdk-meta-row">
                <a href="/authenticate/implement-workflows/implement-webhooks" class="action-link">
                  See docs
                </a>
              </div>

              <div class="sdk-actions">
                <LinkButton
                  href="/apis/#webhook/organizationcreated"
                  variant="secondary"
                  icon="right-arrow"
                  iconPlacement="end"
                  class="sk-secondary"
                >
                  View events
                </LinkButton>
              </div>
            </div>
          </FoldCard>

          <FoldCard
            title="Interceptors"
            iconKey="workflow"
            href="/reference/interceptors/triggers"
            showCta={false}
            showTitle={true}
            clickable={false}
            ctaSmall={true}
          >
            <div class="sdk-card-subtitle">
              Apply custom logic and policy checks during authentication & authorization flows
            </div>

            <div class="sdk-bottom-row">
              <div class="sdk-meta-row">
                <a href="/authenticate/interceptors/auth-flow-interceptors" class="action-link">
                  See docs
                </a>
              </div>

              <div class="sdk-actions">
                <LinkButton
                  href="/reference/interceptors/triggers"
                  variant="secondary"
                  icon="right-arrow"
                  iconPlacement="end"
                  class="sk-secondary"
                >
                  View triggers
                </LinkButton>
              </div>
            </div>
          </FoldCard>
        </div>
      </div>
    </div>
  </div>
</StarlightPage>

<script>
  // Prevent card click when clicking on footer links
  document.querySelectorAll('.action-link').forEach((link) => {
    link.addEventListener('click', (e) => {
      e.stopPropagation()
    })
  })
</script>
