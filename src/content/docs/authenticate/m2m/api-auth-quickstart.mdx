---
title: Add auth to your APIs
description: "Secure your APIs in minutes with OAuth 2.0 client credentials, scoped access, and JWT validation using Scalekit"
browseCentral:
  label: "API authentication with M2M OAuth"
  filterType: ["tutorial"]
  category: ["Auth modules"]
  icon: book
banner:
  content: |
    Join our dev community to connect with Scalekit engineers for questions or feedback
head:
  - tag: style
    content: |
      .sl-markdown-content h2 {
        font-size: var(--sl-text-xl);
      }
      .sl-markdown-content h3 {
        font-size: var(--sl-text-lg);
      }
sidebar:
  label: "Quickstart: API Auth"
---

import { LinkButton, Aside, Steps, Tabs, TabItem, Badge } from '@astrojs/starlight/components';
import InstallSDK from '@components/templates/_installsdk.mdx';

APIs are a fundamental mechanism for systems to communicate and exchange data. By exposing API endpoints, applications enable customers, partners, and external systems to interact seamlessly, creating deeper integrations and increasing the _stickiness_ to your app and it's usecases.

Exposing APIs without any authentication is like leaving your door wide open for anyone to walk in. Anyone can access your API endpoints, potentially causing security breaches, data leaks, and unauthorized usage.

In this guide let's take a look at how your can add OAuth2.0 based client credentials authentication to your APIs to ensure only authorized clients can consume your APIs.

```d2
shape: sequence_diagram

API Client
User

User -> Your App: 1. Request to register \n an API client \n with necessary scopes
Your App -> Scalekit: 2. Creates an API client \n in your Scalekit environment
Scalekit -> Your App: 3. Gives you a client_id \n and client_secret
Your App -> User: Show the client credentials
User -> API Client: 4. Saves the API credetials
API Client -> Your App: 5. Requests access to \n protected resource
Your App <> Scalekit: 6. Validates the access tokens
Your App -> API Client: 7. Returns the protected resource

```

<Steps>

1. ## Installation

   Scalekit becomes the authorization server for your APIs. Using Scalekit provides necessary methods to register and authenticate API clients.

   ```sh showLineNumbers=false
   pip install scalekit-sdk-python
   ```
   Alternatively, you can use the <a href="https://docs.scalekit.com/apis/#tag/api-auth" target="_blank" rel="noopener">REST APIs directly</a>.

   <Aside>
   Currently Scalekit supports Python SDKs, <a href="/support/contact-us">contact us</a> if you need support for your tech stack.
   </Aside>


2. ## Enable API client registration for your customers

   To enable secure API access, you must first register an application as an API client. This process generates unique credentials that will authenticate the client when interacting with your API.

   Upon registration, your app obtains a client ID and secret â€” essentially an application-level authentication mechanism. These credentials should be securely shared with your API client developers for integration (usually via view-once UI).

   <Tabs syncKey="tech-stack">
   <TabItem value="curl" label="cURL">

   ```bash title="POST /organizations/{organization_id}/clients"
   # For authentication details, see: http://docs.scalekit.com/apis#description/authentication
   curl -L '<SCALEKIT_ENVIRONMENT_URL>/api/v1/organizations/<ORGANIZATION_ID>/clients' \
   -H 'Content-Type: application/json' \
   -H 'Authorization: Bearer <SCALEKIT_ACCESS_TOKEN>' \
   -d '{
       "name": "GitHub Actions Deployment Service",  # A descriptive name for the API client
       "description": "Service account for GitHub Actions to deploy applications to production",  # A detailed explanation of the clients purpose and usage
       "custom_claims": [  # Key-value pairs that provide additional context about the client. Each claim must have a `key` and `value` field
           {
               "key": "github_repository",
               "value": "acmecorp/inventory-service"
           },
           {
               "key": "environment",
               "value": "production_us"
           }
       ],
       "scopes": [  # List of permissions the client needs (e.g., ["deploy:applications", "read:deployments"])
           "deploy:applications",
           "read:deployments"
       ],
       "audience": [  # List of API endpoints this client will access (e.g., ["deployment-api.acmecorp.com"])
           "deployment-api.acmecorp.com"
       ],
       "expiry": 3600  # Token expiration time in seconds. Defaults to 3600 (1 hour)
   }'
   ```

   ```json title="Sample response"
   {
       "client": {
           "client_id": "m2morg_68315758685323697",
           "secrets": [
               {
                   "id": "sks_68315758802764209",
                   "create_time": "2025-04-16T06:56:05.360Z",
                   "update_time": "2025-04-16T06:56:05.367190455Z",
                   "secret_suffix": "UZ0X",
                   "status": "ACTIVE",
                   "last_used_time": "2025-04-16T06:56:05.360Z"
               }
           ],
           "name": "GitHub Actions Deployment Service",
           "description": "Service account for GitHub Actions to deploy applications to production",
           "organization_id": "org_59615193906282635",
           "create_time": "2025-04-16T06:56:05.290Z",
           "update_time": "2025-04-16T06:56:05.292145150Z",
           "scopes": [
               "deploy:applications",
               "read:deployments"
           ],
           "audience": [
               "deployment-api.acmecorp.com"
           ],
           "custom_claims": [
               {
                   "key": "github_repository",
                   "value": "acmecorp/inventory-service"
               },
               {
                   "key": "environment",
                   "value": "production_us"
               }
           ]
       },
       "plain_secret": "test_ly8G57h0ErRJSObJI6dShkoa..."
   }
   ```
   </TabItem>
   <TabItem value="python" label="Python">

   ```python
   from scalekit.v1.clients.clients_pb2 import OrganizationClient

   org_id = "<SCALEKIT_ORGANIZATION_ID>"

   api_client = OrganizationClient(
       name="GitHub Actions Deployment Service",  # A descriptive name for the API client
       description="Service account for GitHub Actions to deploy applications to production",  # A detailed explanation of the client's purpose and usage
       custom_claims=[  # Key-value pairs that provide additional context about the client. Each claim must have a `key` and `value` field
           {
               "key": "github_repository",
               "value": "acmecorp/inventory-service"
           },
           {
               "key": "environment",
               "value": "production_us"
           }
       ],
       scopes=["deploy:applications", "read:deployments"],  # List of permissions the client needs
       audience=["deployment-api.acmecorp.com"],  # List of API endpoints this client will access
       expiry=3600  # Token expiration time in seconds. Defaults to 3600 (1 hour)
   )

   response = scalekit_client.m2m_client.create_organization_client(
       organization_id=org_id,
       m2m_client=api_client
   )

   # Persist the generated credentials securely in your application
   client_id = response.client.client_id
   plain_secret = response.plain_secret
   ```

   ```json title="Sample response"
   {
       "client": {
           "client_id": "m2morg_68315758685323697",
           "secrets": [
               {
                   "id": "sks_68315758802764209",
                   "create_time": "2025-04-16T06:56:05.360Z",
                   "update_time": "2025-04-16T06:56:05.367190455Z",
                   "secret_suffix": "UZ0X",
                   "status": "ACTIVE",
                   "last_used_time": "2025-04-16T06:56:05.360Z"
               }
           ],
           "name": "GitHub Actions Deployment Service",
           "description": "Service account for GitHub Actions to deploy applications to production",
           "organization_id": "org_59615193906282635",
           "create_time": "2025-04-16T06:56:05.290Z",
           "update_time": "2025-04-16T06:56:05.292145150Z",
           "scopes": [
               "deploy:applications",
               "read:deployments"
           ],
           "audience": [
               "deployment-api.acmecorp.com"
           ],
           "custom_claims": [
               {
                   "key": "github_repository",
                   "value": "acmecorp/inventory-service"
               },
               {
                   "key": "environment",
                   "value": "production_us"
               }
           ]
       },
       "plain_secret": "test_ly8G57h0ErRJSObJI6dShkoaq6bigo11Dxcf.."
   }
   ```

   </TabItem>
   </Tabs>

   <Aside type="tip">
     Scalekit only returns the `plain_secret` once during client creation and does not store it. Instruct your API client developers to store the `plain_secret` securely.
   </Aside>

3. ## API client requests Bearer access token for API authentication

    API clients use the `client_id` and `client_secret` issued in the previous step to reach your Scalekit environment and get the access token. No action is needed by you in your API server. This section only demonstrates how API clients get the `access_token`.

   The client sends a POST request to the `/oauth/token` endpoint:

   <Tabs syncKey="tech-stack">
   <TabItem value="curl" label="cURL">

   ```sh title="POST /oauth/token"
   curl -X POST \
     "https://<SCALEKIT_ENVIRONMENT_URL>/oauth/token" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "grant_type=client_credentials" \
     -d "client_id=<API_CLIENT_ID>" \
     -d "client_secret=<API_CLIENT_SECRET>" \
   ```

   </TabItem>
   <TabItem value="python" label="Python">

   ```python showLineNumbers
   client_id = "API_CLIENT_ID"
   client_secret = "API_CLIENT_SECRET"

   token_response = scalekit_client.generate_client_token(
       client_id=client_id,
       client_secret=client_secret
   )
   ```

   </TabItem>
   </Tabs>

   Upon successful authentication, your Scalekit environment issues a JWT access token to the API client.

   ```json title="Access token response"
   {
     "access_token":"<API_CLIENT_JWT_ACCESS_TOKEN>",
     "token_type":"Bearer",
     "expires_in":86399,
     // Same scopes that were granted during client registration
     "scope":"deploy:applications read:deployments"
   }
   ```

   The client includes this access token in the `Authorization` header of subsequent requests to your API server. Your API server validates these tokens before granting access to resources.

4. ## Validate and authenticate API client's access tokens

   Your API server must validate the incoming JWT access token to ensure the request originates from a trusted API client and that the token is legitimate.

   Validate the token in two steps:

   <Steps>

   1. **Retrieve the public key:** Fetch the appropriate public key from your Scalekit environment's JSON Web Key Set (JWKS) endpoint. Use the `kid` (Key ID) from the JWT header to identify the correct key. Cache the key according to standard JWKS practices.

      <Tabs syncKey="tech-stack">
      <TabItem value="javascript" label="Node.js">

      ```js showLineNumbers=false
      import jwksClient from 'jwks-rsa';

      const client = jwksClient({
        jwksUri: 'YOUR_JWKS_URI',
        cache: true
      });

      async function getPublicKey(header: any): Promise<string> {
        return new Promise((resolve, reject) => {
          client.getSigningKey(header.kid, (err, key) => {
            if (err) reject(err);
            else resolve(key.getPublicKey());
          });
        });
      }
      ```

      </TabItem>
      <TabItem value="python" label="Python">

      ```py showLineNumbers=false
      # This is automatically handled by Scalekit SDK
      ```

      </TabItem>
      </Tabs>

   2. **Verify the token signature:** Use the retrieved public key and a JWT library to verify the token's signature and claims (like issuer, audience, and expiration).

      <Tabs syncKey="tech-stack">
      <TabItem value="javascript" label="Node.js">

      ```js showLineNumbers=false
      import jwt from 'jsonwebtoken';

      async function verifyToken(token: string, publicKey: string) {
        try {
          const decoded = jwt.decode(token, { complete: true });
          const verified = jwt.verify(token, publicKey, {
            algorithms: ['RS256'],
            complete: true
          });
          return verified.payload;
        } catch (error) {
          throw new Error('Token verification failed');
        }
      }
      ```

      </TabItem>
      <TabItem value="python" label="Python">

      ```py showLineNumbers=false
      # Token from the incoming API request's authorization header
      token = token_response["<API_CLIENT_JWT_ACCESS_TOKEN>"]

      claims = scalekit_client.validate_access_token_and_get_claims(
          token=token
      )
      ```

      </TabItem>
      </Tabs>
   </Steps>

   Upon successful token verification, your API server gains confidence in the request's legitimacy and can proceed to process the request, leveraging the authorization scopes embedded within the token.

</Steps>
