---
title: "Implement logout"
description: "Terminate user sessions across your application and Scalekit"
sidebar:
  label: "Implement logout"
prev:
  label: "Manage sessions"
  link: "/authenticate/fsa/manage-session/"
next:
  label: "Manage users & organizations"
  link: "/fsa/data-modelling/"
head:
  - tag: style
    content: |
      .sl-markdown-content h2 {
        font-size: var(--sl-text-xl);
      }
---

import { Aside, Badge, Steps, Tabs, TabItem, Card } from '@astrojs/starlight/components';

When implementing logout functionality, you need to consider three session layers where user authentication state is maintained:

1. **Application session layer**: Your application stores session tokens (access tokens, refresh tokens, ID tokens) in browser cookies. You control this layer completely.

2. **Scalekit session layer**: Scalekit maintains a session for the user and stores their information. When users return to Scalekit's authentication page, their information is remembered for a smoother experience.

3. **Identity provider session layer**: When users authenticate with external providers (for example, Okta through enterprise SSO), those providers maintain their own sessions. Users won't be prompted to sign in again if they're already signed into the provider.

This guide shows you how to clear the application session layer and invalidate the Scalekit session layer in a single logout endpoint.

![](@/assets/docs/fsa/logout/1.png)

<Steps>

1. ## Create a logout endpoint

   Create a `/logout` endpoint in your application that handles the complete logout flow: extracting the ID token, generating the Scalekit logout URL, clearing session cookies, and redirecting to Scalekit.

    <Tabs syncKey="tech-stack">
      <TabItem label="Node.js">
        ```javascript title="Express.js"
        app.get('/logout', (req, res) => {
          // Step 1: Extract the ID token (needed for Scalekit logout)
          const idTokenHint = req.cookies.idToken;
          const postLogoutRedirectUri = 'http://localhost:3000/login';

          // Step 2: Generate the Scalekit logout URL
          const logoutUrl = scalekit.getLogoutUrl({
            idTokenHint,
            postLogoutRedirectUri
          });

          // Step 3: Clear all session cookies with matching Path attributes
          res.clearCookie('accessToken', { path: '/api' });
          res.clearCookie('refreshToken', { path: '/auth/refresh' });
          res.clearCookie('idToken'); // Clear AFTER using it for logout URL

          // Step 4: Redirect to Scalekit to invalidate the session
          res.redirect(logoutUrl);
        });
        ```
      </TabItem>
      <TabItem label="Python">
        ```python title="Flask"
        from flask import request, redirect, make_response
        from scalekit import LogoutUrlOptions

        @app.route('/logout')
        def logout():
            # Step 1: Extract the ID token (needed for Scalekit logout)
            id_token = request.cookies.get('idToken')
            post_logout_redirect_uri = 'http://localhost:3000/login'

            # Step 2: Generate the Scalekit logout URL
            logout_url = scalekit.get_logout_url(
                LogoutUrlOptions(
                    id_token_hint=id_token,
                    post_logout_redirect_uri=post_logout_redirect_uri
                )
            )

            # Step 3: Create response and clear all session cookies with matching Path attributes
            response = make_response(redirect(logout_url))
            response.set_cookie('accessToken', '', max_age=0, path='/api')
            response.set_cookie('refreshToken', '', max_age=0, path='/auth/refresh')
            response.set_cookie('idToken', '', max_age=0)  # Clear AFTER using it for logout URL

            # Step 4: Return response that redirects to Scalekit
            return response
        ```
      </TabItem>
      <TabItem label="Go">
        ```go title="Gin"
        func logoutHandler(c *gin.Context) {
            // Step 1: Extract the ID token (needed for Scalekit logout)
            idToken, _ := c.Cookie("idToken")
            postLogoutRedirectURI := "http://localhost:3000/login"

            // Step 2: Generate the Scalekit logout URL
            logoutURL, err := scalekit.GetLogoutUrl(LogoutUrlOptions{
                IdTokenHint: idToken,
                PostLogoutRedirectUri: postLogoutRedirectURI,
            })
            if err != nil {
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
            }

            // Step 3: Clear all session cookies with matching Path attributes
            c.SetCookie("accessToken", "", -1, "/api", "", true, true)
            c.SetCookie("refreshToken", "", -1, "/auth/refresh", "", true, true)
            c.SetCookie("idToken", "", -1, "/", "", true, true)  // Clear AFTER using it for logout URL

            // Step 4: Redirect to Scalekit to invalidate the session
            c.Redirect(http.StatusFound, logoutURL.String())
        }
        ```
      </TabItem>
      <TabItem label="Java">
        ```java title="Spring Boot"
        @GetMapping("/logout")
        public void logout(HttpServletRequest request, HttpServletResponse response) throws IOException {
            // Step 1: Extract the ID token (needed for Scalekit logout)
            String idToken = Arrays.stream(request.getCookies())
                .filter(c -> c.getName().equals("idToken"))
                .findFirst()
                .map(Cookie::getValue)
                .orElse(null);
            String postLogoutRedirectUri = "http://localhost:3000/login";

            // Step 2: Generate the Scalekit logout URL
            LogoutUrlOptions options = new LogoutUrlOptions();
            options.setIdTokenHint(idToken);
            options.setPostLogoutRedirectUri(postLogoutRedirectUri);
            URL logoutUrl = scalekit.authentication().getLogoutUrl(options);

            // Step 3: Clear all session cookies with matching Path attributes
            Cookie accessTokenCookie = new Cookie("accessToken", null);
            accessTokenCookie.setMaxAge(0);
            accessTokenCookie.setPath("/api");
            response.addCookie(accessTokenCookie);

            Cookie refreshTokenCookie = new Cookie("refreshToken", null);
            refreshTokenCookie.setMaxAge(0);
            refreshTokenCookie.setPath("/auth/refresh");
            response.addCookie(refreshTokenCookie);

            Cookie idTokenCookie = new Cookie("idToken", null);
            idTokenCookie.setMaxAge(0);
            idTokenCookie.setPath("/");
            response.addCookie(idTokenCookie);  // Clear AFTER using it for logout URL

            // Step 4: Redirect to Scalekit to invalidate the session
            response.sendRedirect(logoutUrl.toString());
        }
        ```
      </TabItem>
    </Tabs>

    **Important**: The logout flow clears cookies AFTER extracting the ID token and generating the logout URL. This ensures the ID token is available for Scalekit's logout endpoint.

2.  ## Configure post-logout redirect URL

    After users log out, Scalekit redirects them to the URL you specify in the `post_logout_redirect_uri` parameter. This URL must be registered in your Scalekit dashboard under **Dashboard > Authentication > Redirects > Post Logout URL**.

    Scalekit only redirects to URLs from your allow list. This prevents unauthorized redirects and protects your users. If you need different redirect URLs for different applications, you can register multiple post-logout URLs in your dashboard.

</Steps>

<Aside type="tip" title='Logout security checklist'>
- Extract the ID token BEFORE clearing cookies (needed for Scalekit logout)
- Clear cookies with matching `Path` attributes: `/api` for `accessToken`, `/auth/refresh` for `refreshToken`
- Redirect to Scalekit's logout endpoint to invalidate the session server-side
- Ensure your post-logout redirect URI is registered in the Scalekit dashboard
</Aside>